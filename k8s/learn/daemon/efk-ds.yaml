apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: fluentd-elasticsearch
  labels:
    k8s-app: fluentd-logging
spec:
  selector:
    matchLabels:
      name: fluentd-elasticsearch
  template:
      metadata:
        labels:
          name: fluentd-elasticsearch
      spec:
        tolerations:
          - key: node-role.kubernetes.io/master
            effect: NoSchedule
        containers:
          - name: fluentd-elasticsearch
            image: k8s.gcr.io/fluentd-elasticsearch:v2.2.0
            resources:
              limits:
                memory: 200Mi
              requests:
                cpu: 100m
                memory: 200Mi
            volumeMounts:
              - mountPath: /var/log
                name: varlog
              - mountPath: /var/lib/docker/containers
                name: varlibdockercontainers
                readOnly: true
        terminationGracePeriodSeconds: 30
        volumes:
          - name: varlog
            hostPath:
              path: /var/log
          - name: varlibdockercontainers
            hostPath:
              path: /var/lib/docker/containers
